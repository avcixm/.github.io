<link rel="stylesheet" href="{{ '/assets/css/overrides.css' | relative_url }}">

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('a[href]').forEach(function (a) {
    var href = a.getAttribute('href');
    if (!href || href.startsWith('#')) return;

    // only http(s) links, and only if host differs from this site
    if (/^https?:\/\//i.test(href)) {
      var u = new URL(href, document.baseURI);
      if (u.hostname !== location.hostname) {
        a.setAttribute('target', '_blank');
        a.setAttribute('rel', 'noopener noreferrer');
      }
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('details.hover-open').forEach(function (det) {
    const sum = det.querySelector('summary');
    if (!sum) return;

    // Open on hover / focus
    det.addEventListener('mouseenter', () => { det.open = true; });
    det.addEventListener('mouseleave', () => { det.open = false; });
    sum.addEventListener('focus', () => { det.open = true; });
    sum.addEventListener('blur',  () => { det.open = false; });

    // Keep click working for mobile/keyboard (no changes needed)
    // Optional: ESC closes
    sum.addEventListener('keydown', (e) => { if (e.key === 'Escape') det.open = false; });
  });
});
</script>

<script>
/* Export buttons: PDF opens print dialog; DOC/TXT generated client-side */
document.addEventListener('DOMContentLoaded', function () {
  const contentSel = '.page__content';
  function getContentNode() {
    const node = document.querySelector(contentSel) || document.querySelector('main') || document.body;
    const clone = node.cloneNode(true);
    // remove the export bar from the exported content
    const bar = clone.querySelector('.download-bar');
    if (bar) bar.remove();
    return clone;
  }
  function download(filename, blob){
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click();
    requestAnimationFrame(()=>{ URL.revokeObjectURL(url); a.remove(); });
  }
  function htmlForWord(innerHTML, title){
    return `
      <html xmlns:o='urn:schemas-microsoft-com:office:office'
            xmlns:w='urn:schemas-microsoft-com:office:word'
            xmlns='http://www.w3.org/TR/REC-html40'>
        <head><meta charset="utf-8"><title>${title}</title></head>
        <body>${innerHTML}</body>
      </html>`;
  }

  document.querySelectorAll('.download-bar .export').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const kind  = btn.dataset.kind; // pdf | doc | txt
      const title = (document.querySelector('.page__title')?.innerText || document.title).trim().replace(/\s+/g,'_');

      if (kind === 'pdf') { window.print(); return; }

      const node = getContentNode();
      if (kind === 'txt') {
        const text = node.innerText.replace(/\n{3,}/g, '\n\n');
        download(`${title}.txt`, new Blob([text], {type:'text/plain'}));
      } else if (kind === 'doc') {
        const html = htmlForWord(node.innerHTML, title);
        download(`${title}.doc`, new Blob([html], {type:'application/msword'}));
      }
    });
  });
});
</script>
